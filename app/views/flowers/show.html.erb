<p id="notice"><%= notice %></p>

<script src="http://datejs.googlecode.com/files/date.js"></script>
<script src="http://d23cj0cdvyoxg0.cloudfront.net/cosmjs-1.0.0.min.js"></script>  

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);

      function humanizeDate(aDate) {
         return Date.parseExact(aDate.split(".")[0],"yyyy-MM-ddTHH:mm:ss").toString("MM/dd HH:mm")
      }

      function drawChart() {
        cosm.setKey( "DuEKET_N9sKpxolqa9JUEJ7y8AOSAKxMN1hGaWJRNlVqYz0g" );
        var data_array = [ ['DateTimeStamp', 'Влажность'] ];

        cosm.datapoint.history ("89489", "<%=@flower.id%>", {
          "start" : "<%=DateTime.now - 5%>",
          "end" : "<%=DateTime.now%>", 
          "interval" : "300", 
          "limit" : "1000"
        }, function( data ) {
          data_array.push([humanizeDate(data[0]['at']), parseInt(data[0]['value']) - 3]);

          for (var i = 0; i < data.length; i++) {            
            data_array.push([humanizeDate(data[i]['at']), parseInt(data[i]['value'])]);
          };

          data_array.push([humanizeDate(data[data.length - 1]['at']), parseInt(data[data.length - 1]['value']) + 1]);

          var options = {
            title: 'График увлажнённости за последние 5 дней'
          };

          var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(google.visualization.arrayToDataTable(data_array), options);
        });        
      }
    </script>

    <div id="chart_div"></div>

    <br/>
    <br/>

<%= link_to 'Edit', edit_flower_path(@flower) %> |
<%= link_to 'Back', flowers_path %>
